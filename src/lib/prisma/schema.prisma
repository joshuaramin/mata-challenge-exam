generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model Customer {
  customer_id String   @id @default(cuid())
  email       String   @unique @db.VarChar(255)
  password    String   @db.VarChar(255)
  is_deleted  Boolean  @default(false)
  created_at  DateTime @default(now()) @db.Timestamp()
  updated_at  DateTime @default(now()) @updatedAt @db.Timestamp()
  Profile     Profile?
  Sales       Sales[]

  // Indexes
  @@index([created_at])
  @@index([is_deleted])
}

model Profile {
  profile_id  String    @id @default(cuid())
  first_name  String    @db.VarChar(100)
  last_name   String    @db.VarChar(100)
  is_deleted  Boolean   @default(false)
  created_at  DateTime  @default(now()) @db.Timestamp()
  updated_at  DateTime  @default(now()) @updatedAt @db.Timestamp()
  customer    Customer? @relation(fields: [customer_id], references: [customer_id])
  customer_id String?   @unique

  @@index([first_name])
  @@index([last_name])
  @@index([is_deleted])
}

model Product {
  product_id  String      @id @default(cuid())
  name        String      @db.VarChar(255)
  description String?     @db.Text
  price       Float
  quantity    Int
  is_deleted  Boolean     @default(false)
  created_at  DateTime    @default(now()) @db.Timestamp()
  updated_at  DateTime    @default(now()) @updatedAt @db.Timestamp()
  SalesItem   SalesItem[]

  @@index([name])
  @@index([price])
  @@index([is_deleted])
  @@index([created_at])
}

model Sales {
  sales_id     String      @id @default(cuid())
  total_amount Float
  sale_date    DateTime    @default(now()) @db.Timestamp()
  customer     Customer?   @relation(fields: [customer_id], references: [customer_id])
  customer_id  String?
  Items        SalesItem[]
  is_deleted  Boolean     @default(false)
  created_at  DateTime    @default(now()) @db.Timestamp()
  updated_at  DateTime    @default(now()) @updatedAt @db.Timestamp()

  @@index([customer_id])
  @@index([sale_date])
}

model SalesItem {
  sales_item_id String   @id @default(cuid())
  quantity      Int
  unitPrice     Decimal  @db.Decimal(10, 2)
  subTotal      Decimal  @db.Decimal(12, 2)
  product       Product? @relation(fields: [product_id], references: [product_id])
  product_id    String?
  sales         Sales?   @relation(fields: [sales_id], references: [sales_id])
  sales_id      String?
  is_deleted  Boolean     @default(false)
  created_at  DateTime    @default(now()) @db.Timestamp()
  updated_at  DateTime    @default(now()) @updatedAt @db.Timestamp()

  @@unique([sales_id, product_id])
  @@index([sales_id])
  @@index([product_id])
}
